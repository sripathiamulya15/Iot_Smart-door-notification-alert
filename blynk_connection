#define BLYNK_TEMPLATE_ID "TMPL3vK_6U8B6"
#define BLYNK_TEMPLATE_NAME "Smart Door Notification"
#define BLYNK_AUTH_TOKEN "a8UgXpfb0aYKFQnm-jumwhGJof9PCbCa"
#define BLYNK_PRINT Serial
#include <WiFi.h>
#include <BlynkSimpleEsp32.h>

#define DOOR_SENSOR  4
#define buzzer 2
BlynkTimer timer;
char auth[] = BLYNK_AUTH_TOKEN; //Enter the authentication code sent by Blynk to your Email
char ssid[] = ""; //Enter your WIFI SSID
char pass[] = ""; //Enter your WIFI Password
int flag=0;

void notifyOnButtonPress()
{
  int isButtonPressed = digitalRead(DOOR_SENSOR);
  
  if (isButtonPressed == 0 && flag == 0) {  // 0 means door opened now
    Serial.println("Someone Opened the door");
    Blynk.logEvent("security_alert", "Someone opened the Door");
    digitalWrite(buzzer, HIGH);
    flag = 1;
  } 
  else if (isButtonPressed == 1) {  // 1 means door closed
    flag = 0;
    Serial.println("Door Closed");
    digitalWrite(buzzer, LOW);
  }
}

void setup() {
  Serial.begin(115200);
  Serial.println("Booting ESP32...");
  delay(1000);
  Serial.println("Connecting to wifi....");
  Blynk.begin(auth, ssid, pass);
  Serial.println("Connected to wifi!");
  pinMode(DOOR_SENSOR, INPUT_PULLUP);
  pinMode(buzzer, OUTPUT);
  timer.setInterval(5000L, notifyOnButtonPress);
}

void loop()
{
  Blynk.run();
  timer.run();
}
